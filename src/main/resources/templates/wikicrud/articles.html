
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Wiki Articles</title>
    <link rel="stylesheet" th:href="@{/css/wikinav.css}">
    <meta charset="UTF-8">
</head>
<body th:style="'background-color:' + ${randomColor}">
    <div th:replace="fragments/navbar :: topnav"></div>

    <div class="listcontainer">
    <h1>Wiki Articles Browser</h1>

    <div th:if="${resultMessage}" th:text="${resultMessage}"></div>

    <!--Display on tag-based search only-->
    <div th:if="${activeTags != null}">
        <p>Showing articles tagged with: <strong th:text="${activeTags}">tags</strong></p>
    </div>

    <!--Display on category-based filter only-->
    <div th:if="${categoryName != null}">
        <p>Showing articles in category: <strong th:text="${categoryName}">categoryname</strong></p>
    </div>

    <!--ARTICLE DISPLAY CLAUSES HERE-->
    <!-- Admin toggle for hidden articles -->
    <div th:if="${session.loggedInAdmin != null}" style="margin-bottom:8px;">
        <a th:href="@{/wiki/admin/toggleHidden}" th:text="${session.showHidden} ? 'Hide hidden articles' : 'Show hidden articles'"></a>
    </div>

    <!-- Show all articles if admin enabled hidden view -->
    <div th:if="${session.loggedInAdmin != null and session.showHidden == true}">
        <ul>
            <li th:each="article : ${articles}">
                <a th:href="@{'/wiki/articles/' + ${article.id}}" th:text="${article.title}">Article Title</a>
                <span th:text="${#dates.format(article.dateCreate, 'yyyy-MM-dd HH:mm')}"></span>
                <span th:if="${article.hiddenFlag}" style="color: red;">(Hidden)</span>
            </li>
        </ul>
    </div>
    <!-- Show only visible articles to non-admins and admins who haven't enabled hidden view -->
    <div th:unless="${session.loggedInAdmin != null and session.showHidden == true}">
        <ul>
            <li th:each="article : ${articlesCensored}">
                <a th:href="@{'/wiki/articles/' + ${article.id}}" th:text="${article.title}">Article Title</a>
                <span th:text="${#dates.format(article.dateCreate, 'yyyy-MM-dd HH:mm')}"></span>
            </li>
        </ul>
    </div>

    <!--No articles existent-->
    <div th:if="${session.loggedInAdmin == null and (articlesCensored == null or #lists.isEmpty(articlesCensored))}">
        <p>No articles found.</p>
    </div>

    <div th:if="${session.loggedInAdmin != null and (articles == null or #lists.isEmpty(articles))}">
        <p>No articles found.</p>
    </div>
    <!--END ARTICLE CLAUSES-->

    <a th:if="${session.loggedInAdmin != null}" 
    href="/wiki/articles/new">Create New Article</a>

    <!--Return if checking by category-->
    <div th:if="${categoryName != null}">
        <a th:href="@{/wiki/categories}">Back to Categories</a>

    <div th:if="${session.loggedInAdmin != null and categoryId != 1}">
    <form th:action="@{/wiki/categories/purge}" method="post">
        <input type="hidden" name="categoryId" th:value="${categoryId}" />
        <button type="submit"
                onclick="return confirm('Are you sure you want to purge this category?')"
                style="font-size:16px;font-family:'Comic Sans MS';background:none;border:none;color:red;text-decoration:underline;cursor:pointer;">
            Purge category
        </button>
    </form>
    </div>


    </div>
    </div> <!--Closes:Listcontainer-->
</body>
</html>
